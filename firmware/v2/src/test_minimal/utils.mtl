fun dumpList l0=
  for l=l0;l!=nil;tl l do (Secho hd l; Secho "::");
  Secholn "nil";;

fun split data separator lst =
  let strlen data -> len in
  let strstr data separator 0 -> idx in
  let strsub data 0 idx -> a in
  let strsub data idx+1 len-idx-1 -> b in
    if idx == nil then data::lst
    else split b separator a::lst;;

var conn;;

fun _writetcpconn data n = 
  /*for l=conn;l!=nil;tl l do (
    led 0 0x00FF00;
    writetcp hd l data 0
  )*/
  if n > 10 then
    nil
  else (
    let writetcp conn data 0 -> ret in
    if ret == nil then
      _writetcpconn data n+1
  )
  ;;

fun writetcpconn data =
  if _writetcpconn data 0 == nil then
    led 0 0xFF0000
  else
    led 0 0x00FF00
  ;;

fun _strtohex key i=
  if i < strlen key then (ctoh strget key i)::_strtohex key i+1;;
fun strtohex key=
  strcatlist _strtohex key 0;;
