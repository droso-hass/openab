//#define SIMU

proto main 0;;
var NOMINAL;;

#include lib/std/utils.mtl
#include lib/std/debug.mtl
#include lib/const/config.mtl

#ifdef SIMU
var SIMU;;
#include lib/net/simu.mtl
#include lib/net/dhcp.mtl
#include lib/net/dns.mtl
#endif

#ifndef SIMU
#include lib/net/arp.mtl
#include lib/net/ip.mtl
#include lib/net/tcp.mtl
#include lib/net/udp.mtl
#include lib/net/dhcp.mtl
#include lib/net/net.mtl
#include lib/net/dns.mtl
#endif

#include lib/const/led.mtl
#include utils.mtl
#include led.mtl
#include handlers.mtl
#include server.mtl

fun mainSetup = 
    ledInit;
    Secholn "test";;

fun mainLoop = 
    ledLoop;
    Secholn "loop";
    0;;

fun main=
    Secholn "starting";
    confInit;
    netstart;
    startdnsclient;
    mainSetup;
    startsocketserver 5000;
    loopcb #mainLoop;
    Secholn "hello world ------------";
    // test
    //ledHandler "1;1500;00FF00;1000;FF0000;2000;0000FF;3000;FF00FF;500" time_ms;
    //ledHandler "4;0;00FF00;500;02a802;500;005700;500;000000;500;005700;500;02a802;500" time_ms;
    0;;
